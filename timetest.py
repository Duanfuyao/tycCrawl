# -*- coding: gbk -*-
import re
import os.path as path
import os
import math
import json
def find_match(reg1,reg2,context):
    pattern1=re.compile(reg1)
    result1=pattern1.findall(context)
    if len(result1)<1:
        pattern2 = re.compile(reg2)
        result2 = pattern2.findall(context)
        return result2
    return result1

def getAllStartIndex(mainContext,toFind):
    ret=[]
    sa=0
    while True:
        si=mainContext.find(toFind,sa)
        if si==-1:
            break
        ret.append(si)
        sa=si
    return ret
def getAllTimeIndex(mainContext,timeList):
    ret={}
    for t in timeList:
        if t in ret: continue
        indexList=getAllStartIndex(mainContext,t)
        ret[t]=indexList
    return ret


'''
test_string="2019-05-29"
string="编号: BJB190087-01FG\n（重新公告）\n1. 招标条件\n        南京江北新区公用资产投资发展有限公司 建设项目南京江北新区直管区2019年智能交通配套项目（盘城、沿江、泰山、顶山区域范围）设计已经立项部门批准建设（立项批文号：宁新区管建[2019]104号）。工程所需资金来源国有政府性资金：8560.00万元，其中财政性资金：万元其他政府性资金：8560.00万元，现已落实。本工程对投标申请人的资格审查，采用资格后审方法选择合格的投标申请人参加投标。\n         江苏中大建设项目管理有限公司受招标人委托(或招标人)负责本工程的招标事宜。\n2. 项目概述与招标范围\n        2.1 标段名称：设计\n        2.2 工程地点：盘城、沿江、泰山、顶山\n        2.3 工程类型： 大型工程\n        2.4 建设内容及规模： 南京江北新区直管区2019年智能交通配套项目（盘城、沿江、泰山、顶山区域范围）。对各智能交通配套项目原先的260个旧站台结构及构筑物进行拆除，包括190个国标站牌和70个旧站亭的拆除工程；新建公交站台7座；对各站点选址进行施工，包括基础工程、上部钢结构站亭主体工程、智能终端设备工程、环卫设施等其他配套工程等。具体实施按规划要求、道路实际情况和公交线网需要综合确定。\n        2.5 设计合同估算价：70.00万元（工程计费额按7000.00万元）\n        2.6 设计及相关服务范围：\n              设计范围包括：南京江北新区直管区2019年智能交通配套项目（盘城、沿江、泰山、顶山区域范围），设计包括负责初步设计（含初步设计概算）、施工图设计（含施工图预算编制）、配合施工图审查以及全过程设计跟踪。全过程设计跟踪包括：各阶段招标配合和施工现场配合服务，施工期间派驻现场设计代表、设计修改、变更、相关专题报告、竣工验收等服务工作。\n              其它阶段相关服务的范围包括：无\n        2.7 设计服务期：10日历天\n3. 投标人资格要求\n        3.1 投标人资质等级及范围：无\n        3.2 项目经理资质类别和等级：无\n        3.3 本次招标是否接受联合体投标：否\n        3.4 本次招标是否接受黄牌警示单位投标：否\n4. 招标文件的获取\n        4.1 本公告发布之日起至投标截止之日止，凡有意参加投标者，请登录南京市公共资源交易中心网站（ggzy.njzwfw.gov.cn/njggzy）购买招标文件。\n        4.2 招标文件下载费用100元，工具使用费最高100元，平台使用费最高100元\n5. 资格审查办法\n        5.1 对投标人的资格审查方法按照苏建招办（2014）8号文件及有关法规文件的规定执行。\n        5.2 本工程按照苏建招办（2014）8号文件规定，资审合格的必要合格条件为：\n                （1）具有独立订立合同的能力；\n                （2）未处于被责令停业，投标资格被取消或者财产被接管，冻结和破产状态；\n                （3）企业没有因骗取中标或者严重违约以及发生重大工程质量，安全生产事故等问题，被有关部门暂停投标资格并在暂停期内的；\n                （4）企业的资质类别等级和设计负责人的资质等级满足招标公告要求；\n                （5）以联合体形式申请资格审查的，联合体的资格（资质）条件必须符合要求，并附有共同投标协议；\n                （6）具有与本工程相类似项目的设计业绩。具体要求为：/\n                （7）符合法律、法规规定的其他条件。\n6. 评标方法\n         本标段采用监理勘察设计综合评估法。\n         6.1投标报价（10分）\n6.1.1设计费最高限价为65.76万元。\n6.1.2评标基准价计算方法：\n方法二：以有效投标文件的投标报价算术平均值为A，最高投标限价为B，则：评标基准价=A×Q1+B×Q2,Q2=1-Q1，Q1的取值范围为30%，35%，40%，45%，50%；Q1值在投标文件开启(解密)前由投标人推选的代表随机抽取确定。评标价等于评标基准价的得满分；偏离评标基准价的相应扣减得分。\n计算算术平均值A时，若5≤有效投标文件＜7家时，应去掉其中的一个最高价和一个最低价；若有效投标文件≥7家，应去掉其中的二个最高价和二个最低价。\n评标委员会在评标报告签字后，上述方法二的评标基准价不因招投标当事人质疑、投诉、复议以及其他任何情形而改变，但评标过程中的计算错误可作调整。\n投标报价等于评标基准价的得满分；偏离评标基准价的，投标报价每高于评标基准价1%扣0.2分，投标报价每低于评标基准价1%扣0.1分，偏离不足1%的，用插入法计算。\n6.2企业业绩（8分）\n2016年4月1日（含）以来，企业承担过公交站台的设计业绩，有一个得4分，满分8分（时间以合同为准，若合同中不能反映出相关数据和内容，一律视为未提供，相关证明材料以“e路阳光”信用平台中的扫描件为准）(满分8分)\n6.3设计方案（50分）\n6.3.1设计构思评分标准（30分）\n（1）项目总体认识分析与理解：对招标范围、内容、项目背景、现状条件等方面阐述理解与分析(等级分：优：6；良：5.4；中：4.8；差：4.2；无：0)\n（2）项目现状调查与分析：对项目所在片区公交站台的现状情况的调查与分析(等级分：优：6；良：5.4；中：4.8；差：4.2；无：0)\n（3）对智能公交站台的认识：对智能公交站台的要求与功能等方面阐述理解与分析(等级分：优：6；良：5.4；中：4.8；差：4.2；无：0)\n（4）设计方案：方案设计标准符合要求，质量目标明确，贴合现场情况，设计方案合理可行(等级分：优：6；良：5.4；中：4.8；差：4.2；无：0)\n（5）投资估算：项目投资估算应科学、合理、有量、有价、有计算且相对准确(等级分：优：6；良：5.4；中：4.8；差：4.2；无：0)\n6.3.2项目解读评分标准（20分）\n（1）项目调查总述及问题分析：对招标范围公交站台的情况分析与认知 (等级分：优：5；良：4.5；中：4；差：3.5；无：0)\n（2）进度计划：承诺的工期满足招标文件要求；总体进度计划和各阶段进度计划是否合理可行、保证措施是否可靠 (等级分：优：5；良：4.5；中：4；差：3.5；无：0)\n（3）质量保证措施：招标项目的设计的质量保证措施、进度保证措施以及服务保证措施 (等级分：优：5；良：4.5；中：4；差：3.5；无：0)\n（4）合理化建议：提出了合理化建议，且合理化建议符合项目实际情况，具有科学性、可行性 (等级分：优：5；良：4.5；中：4；差：3.5；无：0)\n6.4项目组成员及其他（30分）\n6.4.1项目负责人1名：项目负责人具有注册土木工程师（道路工程）及以上资格得 3 分；同时具有高级工程师及以上职称的加 3分（提供注册证书、职称证书，相关证明材料以\"e 路阳光\"信用平台中的扫描件为准）(满分6分)\n6.4.2电气专业人员1名：具有注册电气工程师(供配电）执业资格的得2 分，同时具有高级工程及以上师职称的加 2 分，具有工程师职称的加 1 分（提供注册证书、职称证书，相关证明材料以“e路阳光”信用平台中的扫描件为准）(满分4分)\n6.4.3造价专业人员1名：具有注册造价工程师证书的得 2 分,同时具有高级工程师及以上职称的加 2 分，具有工程师职称的加 1 分（提供注册证书、职称证书，相关证明材料以“e路阳光”信用平台中的扫描件为准） (满分4分)\n6.4.4结构专业人员2名：具有一级注册结构工程师证的得 2 分/人,同时具有高级工程师及以上职称的加2分/人，具有工程师职称的加1 分/人（提供注册证书、职称证书，相关证明材料以“e路阳光”信用平台中的扫描件为准）(满分8分)\n6.4.5道路专业人员 1名：具有高级工程师及以上职称的得 4 分，具有工程师职称的得2分（提供职称证书，相关证明材料以“e路阳光”信用平台中的扫描件为准）(满分4分)\n6.4.6交通专业人员1名：具有交通工程类的高级工程师职称及以上的得4分,具有交通工程类的中级工程师职称的得2分（提供职称证书，若职称证书中不能体现专业，以注册证书或毕业证书上注明的专业为准，相关证明材料以“e路阳光”信用平台中的扫描件为准）(满分4分)\n6.5其他因素评分标准（2分）\n6.5.1企业奖项：企业自 2016年4月1日以来设计的市政工程获得国家级优秀工程勘察设计市政公用工程奖项得2分（需提供获奖证明文件,有效期自发证或者发文之日起算起，发证、发文时间不一致的，以发文的时间为准，相关证明材料以\"e 路阳光\"信用平台中的扫描件为准）(满分2分)\n备注：\n1、评分细则中涉及的企业及相关人员的资质证书(注册证书、职称证书)和业绩证明材料等，均以“e路阳光”信用平台中录入信息为准，相关人员不得重复计分。\n2、投标单位所提供的所有业绩资料、人员证书必须真实可靠，如发现投标单位弄虚作假，则取消其本工程的中标资格，并向建设行政主管部门汇报。\n3、本标段采用设计方案评分点暗标评审，投标人应按招标文件设置的评分点分别编辑。设计方案每项评分按梯次打分，设计方案为各评委独立评分，计分时取各评委评分中去掉一个最高分和一个最低分的平均值为某个投标企业设计方案的最终得分（保留2位小数）\n编制要求：投标文件中的“设计方案”不得出现可识别投标人身份的任何字符和徽标（包括文字、符号、图案、标识、标志、人员姓名、企业名称、投标人独享的企业标准或编号等），相关人员姓名应以职务或职称代替。\n4、中标候选人排序方法：评标委员会对满足招标文件实质性要求的投标文件，按照规定的评分标准进行打分，并按得分由高到低顺序推荐中标候选人，但投标报价低于其成本的除外。综合评分相等时，以投标报价低的优先；投标报价也相等的，以设计方案得分高的优先；如果设计方案得分也相等，由评标委员会现场随机抽取确定中标候选人顺序。\n7. 发布公告的媒介\n        江苏建设工程招标监管网 南京市公共资源交易中心网\n        本公告发布日期从 2019年5月6日15时3分到 2019年5月13日15时3分为止\n8. 其他\n         8.1潜在投标人的单位名称必须与营业执照及资质证书上名称一致，如果不一致，视为资格审查不合格。\n8.2投标申请人资质等级及范围：工程设计综合资质甲级或者市政行业（燃气工程、轨道交通除外）甲级(含)以上。(提供有效的资质证书，相关证明材料以\"e 路阳光\"信用平台中的扫描件为准)。\n8.3项目负责人资质类别和等级：项目负责人必须具有高级工程师资格。（相关证明材料以\"e 路阳光\"信用平台中的扫描件为准)。\n8.4投标人需提供拟投入本工程的项目负责人与投标申请人签订的劳动合同、社保机构出具的近半年（2018年11月至2019年4月）养老保险金缴费证明（须明确缴费月份、个人姓名、缴费单位，且加盖社保中心章或社保中心参保缴费证明电子专用章；如果投标单位是事业单位编制，请提供事业单位主管部门证明）。以上证明资料需要投标人自行扫描至投标文件中，否则将作为资格审查不通过处理。\n8.5开标时投标人的授权委托人必须携带本人有效身份证原件在投标截止时间前出席开标会并递交上述原件，唱标时招标人当场核验其原件，未提供上述原件或未通过核验的投标单位将视为自动放弃投标。\n8.6资格审查时，若投标人或项目负责人是被红牌、黄牌警示的单位和责任人，并在警示期内，将作为资格审查不通过处理（红、黄牌警示信息均以南京市公共资源交易中心网上发布的信息为准）。\n8.7请各投标人自行前往南京市公共资源交易中心办理入库手续，否则可能将会影响投标，有关投标详细操作问题可咨询交易（68505877、68505828）。\n8.8本项目为电子招投标，投标人需从“e路阳光”信用平台中选择相应的扫描件编入投标文件中。投标人应及时更新“e路阳光”材料及时有效，否则将导致资审不通过或者在评标打分中不得分。\n9. 联系方式\n        招  标  人：南京江北新区公用资产投资发展有限公司 代理机构：江苏中大建设项目管理有限公司\n        地       址：南京市浦口区智达路6号 地       址：南京市雨花台区南京南站绿地之窗商务广场B-2栋1007, 1008, 1009, 1010, 1011室\n        邮       编：210000 邮       编：210000\n        联  系  人：何主任 联  系  人：王士强\n        电       话：/ 电       话：02584613358\n        传       真：/ 传       真：02584613368\n        电子邮件：/ 电子邮件：/\n        开户银行： 开户银行：\n        账       号： 账       号："
x=string.split('\n')

reg1="[0-9]+[\s]*[年][\s]*[0-9]+[\s]*[月][\s]*[0-9]+[\s]*[日]"
reg2="[0-9]+[\s]*[\-.\/][\s]*[0-9]+[\s]*[\-.\/][\s]*[0-9]+"
result = find_match(reg1,reg2,test_string)
print(result)
'''
def test(num):
    d = path.dirname(__file__)
    rootdir = d+'/data_ggzy3_part'
    all_fileName=[]
    minL=8888
    for parent, dirnames, filenames in os.walk(rootdir):
        for i in range(num):
            f=open(rootdir+'/'+filenames[i],'r')
            data=json.load(f)
            content=data['text']
            x = content.split('\n')
            reg1 = "[0-9]+[\s]*[年][\s]*[0-9]+[\s]*[月][\s]*[0-9]+[\s]*[日]"
            reg2 = "[0-9]+[\s]*[\-.\/][\s]*[0-9]+[\s]*[\-.\/][\s]*[0-9]+"
            result = find_match(reg1,reg2,content)
            #if(len(result))!=0:
            if len(x)==4:
                print(x)
                print(filenames[i])
                print(data['oriUrl'])
            minL = min(minL, len(x))
                #for xx in x:
                #print(xx)
            #print(result)
            f.close()
    print(minL)
    return all_fileName

test(1000)


